<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AMS - ASSET LINK</title>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/bootstrap-theme.css">
    <link rel="stylesheet" href="../css/animate.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/clusterize.css">
    <link rel="stylesheet" href="../css/font-awesome.css">
    <link rel="shortcut icon" href="../img/Logo.png" type="image/x-icon">
    <link type="text/css" href="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.11/css/dataTables.checkboxes.css"
        rel="stylesheet" />
    <link rel="stylesheet" href="http://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <style>
        .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
        }

        #searchWith th {
            width: 350px;
        }

        .toggle-btn {
            border-radius: 50%;
            border: 2px solid white;
            background: green;
            padding: 2px 10px 5px 9px;
            font-weight: bolder;
            font-size: 18px;
        }

        .toggle-btn:hover {
            cursor: pointer;
        }

        .print_scroll {
            height: 620px;
            overflow: auto;
        }

        .print_scroll thead {
            position: sticky;
            top: 0;
        }

        /* *{
                font-size:12pt;
            } */

        #overlay-printView table th,
        #overlay-printView table td {
            border: 2px solid #000;
            padding: 0.5em;
        }
    </style>
</head>

<body>
    <div class="container" style="border-left:1px soild rgba(0,0,0,0.5)">
        <!-- navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"
            style="background: rgb(59, 56, 56);height:80px">
            <div class="col-md-3" id="menu-bar"
                style="font-size:15pt;font-weight: bolder;color:aliceblue;padding:25px 0 0 40px">
                <div class="row" style="margin-top:-25px;">
                    <span onclick="showNav()">
                        <div class="col-md-2">
                            <div class="menu"><img src="../img/menu_bar.png" alt="logo" width="40" /></div>
                            <div class="menu-text">MENU</div>
                        </div>
                    </span>

                    <div class="col-md-7 offset-3">
                        <select class="form-control text-muted user-class" id="class-options">

                        </select>
                    </div>
                </div>

                <div id="menu-list">
                    <ul class="menu-group">
                        <a href="./viewAssets.html" target="_self">
                            <li class="menu-item">view</li>
                        </a>
                        <a href="./moveAssets.html" target="_self">
                            <li class="menu-item">movement</li>
                        </a>
                        <a href="#" target="_self">
                            <li class="menu-item">certificates</li>
                        </a>
                        <div class="dropright dropdown" id="drodown-menu">
                            <li class="menu-item" data-toggle="dropdown">commissioning</li>
                            <ul class="dropdown-menu">
                                <li class="menu-item active">addition</li>
                                <li class="divider"></li>
                                <li class="menu-item">removal</li>
                            </ul>
                        </div>

                        <li class="menu-item active">asset link</li>
                        </a>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 text-center" style="padding:25px;color:white;font-weight: bolder;font-size:15pt;">
                <div class="logo"><img src="../img/Logo.png" alt="logo" width="40"> <span
                        style="padding:10px;margin-top:50px">ASSETS MANAGEMENT SYSTEM</span></div>
            </div>
            <div class=" col-md-3">
                <div class="row">
                    <div class="col-md-4 offset-6">
                        <div id="username">Username</div>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-danger" style="width:40px;height: 40px;border-radius: 50%;">
                            <span style="color:white" class="fa fa-power-off"></span>
                        </button>
                    </div>
                </div>


            </div>
        </nav>
        <!-- end navigation -->

        <!-- search filters -->
        <div class="row" style="margin-top: 2.897%;">
            <div class="col-md-12" style="height:80vh;padding-right:40px;">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-md-3 text-center" style="font-size:15pt;font-weight: bolder">
                                <br />
                            </div>
                            <div class="col-md-9 ">
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-12">
                                <table class="table" id="searchWith">
                                    <tr>
                                        <th>
                                            <div class="dropdown">
                                                <button class="btn btn-outline-info form-control dropdown-toggle"
                                                    type="button" id="dropdown_link_location" data-toggle="dropdown"
                                                    aria-haspopup="true" aria-expanded="false">
                                                    LOCATION ...
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="dropdown_link_location"
                                                    id="scroll_link_Location">
                                                    <form class="px-4 py-2">

                                                        <div class="input-group">
                                                            <input type="search" id="search_link_location"
                                                                class="form-control" placeholder="Location..."
                                                                onkeyup="onSearch('search_link_location','#empty_link_location')"
                                                                autofocus="autofocus">
                                                            <div class="input-group-append">
                                                                <span class="input-group-text btn btn-danger text-light"
                                                                    id="clear_link_Location"
                                                                    onclick="clearData('#search_link_location','#dropdown_link_location','LOCATION...')"><i
                                                                        class="fa fa-close"></i></span>

                                                            </div>
                                                        </div>

                                                        <!-- <input type="search" class="form-control" id="searchCoin"
                                                                placeholder="BTC" autofocus="autofocus"> -->
                                                    </form>
                                                    <div id="menu_link_location">
                                                        <div id="location_link_Loader" class="dropdown-loader">
                                                            <img src="../img/loading-transparent.gif" alt="">
                                                        </div>
                                                    </div>
                                                    <div id="empty_link_location" class="dropdown-header">No location
                                                        found
                                                    </div>
                                                </div>
                                            </div>
                                        </th>
                                        <th>
                                            <div class="dropdown">
                                                <button class="btn btn-outline-info form-control dropdown-toggle"
                                                    type="button" id="dropdown_link_room" data-toggle="dropdown"
                                                    aria-haspopup="true" aria-expanded="false">
                                                    ROOM...
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="dropdown_link_room"
                                                    id="scrol_link_room">
                                                    <form class="px-4 py-2">

                                                        <div class="input-group">
                                                            <input type="search" id="search_link_room"
                                                                class="form-control" placeholder="room..."
                                                                onkeyup="onSearch('search_link_room','#empty_link_room')"
                                                                autofocus="autofocus">
                                                            <div class="input-group-append">
                                                                <span class="input-group-text btn btn-danger text-light"
                                                                    id="clear_link_room"
                                                                    onclick="clearData('#search_link_room','#dropdown_link_room','ROOM...')"><i
                                                                        class="fa fa-close"></i></span>
                                                            </div>
                                                        </div>

                                                        <!-- <input type="search" class="form-control" id="searchCoin"
                                                                        placeholder="BTC" autofocus="autofocus"> -->
                                                    </form>
                                                    <div id="menu_link_room">
                                                        <div id="Roomload" class="dropdown-loader">
                                                            <img src="../img/loading-transparent.gif" alt="">
                                                        </div>
                                                    </div>
                                                    <div id="empty_link_room" class="dropdown-header">No room found
                                                    </div>
                                                </div>
                                            </div>
                                        </th>
                                        <th>
                                            <input type="text" id="link_description" class="form-control"
                                                placeholder="Description...">
                                        </th>

                                        <th>
                                            <button onclick="search()" type="text" class="btn btn-success form-control">
                                                <span class="fa fa-search"></span>
                                                Search
                                            </button>
                                        </th>
                                    </tr>

                                </table>
                                <form id="frm-example" method="POST">
                                    <div class="row card-body">
                                        <div class="col-md-6">
                                            <table class="table">
                                                <tr>
                                                    <th colspan="6"
                                                        style="padding: 5px;text-align: left;font-size: 12pt;"
                                                        class="text-danger">
                                                        <span style="padding: 5px; width:100px;">Primay Assets</span>
                                                    </th>
                                                </tr>
                                            </table>
                                            <table class="table" id="primAssetsTable">
                                                <thead style="background:#000000;color:#ffffff;">
                                                    <tr>
                                                        <th scope="col">
                                                            #
                                                        </th>
                                                        <th scope="col">
                                                            Asset No

                                                        </th>
                                                        <th scope="col">
                                                            Room

                                                        </th>
                                                        <th scope="col">
                                                            Location

                                                        </th>
                                                        <th scope="col">
                                                            Description

                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody id="current">
                                                    <div id="loader" class="loader">
                                                        <img src="../img/loading-transparent.gif" alt="">
                                                    </div>
                                                    <div id="searchView" class="search_start">
                                                        <p style="margin-top:200px">Please search your asset using the
                                                            search
                                                            above
                                                        </p>
                                                        <img width="100" src="../img/loupe.png" alt="Search">
                                                    </div>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-md-6">
                                            <table class="table">
                                                <tr>
                                                    <th colspan="6"
                                                        style="padding: 5px;text-align: left;font-size: 12pt;"
                                                        class="text-info">
                                                        <span style="padding: 5px; width:100px;">Sub Assets</span>
                                                    </th>
                                                </tr>
                                            </table>
                                            <table class="table" id="subAssetsTable">
                                                <thead style="background:#000000;color:#ffffff;">
                                                    <tr>
                                                        <th scope="col">
                                                            #
                                                        </th>
                                                        <th scope="col">
                                                            Asset No

                                                        </th>
                                                        <th scope="col">
                                                            Room

                                                        </th>
                                                        <th scope="col">
                                                            Location

                                                        </th>
                                                        <th scope="col">
                                                            Description

                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody id="current">
                                                    <div id="loader" class="loader">
                                                        <img src="../img/loading-transparent.gif" alt="">
                                                    </div>
                                                    <div id="searchView" class="search_start">
                                                        <p style="margin-top:200px">Please search your asset using the
                                                            search
                                                            above
                                                        </p>
                                                        <img width="100" src="../img/loupe.png" alt="Search">
                                                    </div>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <button id="printAssets" style="display: none" class="btn btn-sm btn-info"><span
                                        class="fa fa-print"></span>
                                    Assign Primary</button>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="../js/jquery.js"></script>
    <script src="../js/clusterize.min.js"></script>
    <!-- <script src="../js/bootstrap.js"></script> -->
    <script src="../js/bootstrap.bundle.js"></script>
    <script src="../js/tablefilter.js"></script>
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="../js/dataTables.checkboxes.min.js"></script>
    <script type="text/javascript"
        src="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.11/js/dataTables.checkboxes.min.js"></script>


    <script>
        function showNav() {
            $('#menu-list').slideToggle('fast');
        }
        document.getElementById('username').innerHTML = (replaceAll('"', '', localStorage.username)).toUpperCase();

        // replace func
        function replaceAll(find, replace, str) {
            while (str.indexOf(find) > -1) {
                str = str.replace(find, replace);
            }
            return str;
        }

        //reset
        if (localStorage.menuAssets != '' || localStorage.menuRoom != '' || localStorage.menuLocation != '') {
            localStorage.menuAssets = '';
            localStorage.menuLocation = '';
            localStorage.menuRoom = '';
            // populate_dropdown();
        }

        // populate filters
        var user_class = localStorage.getItem("filter");

        var tableArr = {
            search_link_location: [],
            search_link_room: []
        };


        var allArr = {
            primAssetsTable: [],
            searchroomno: []
        };
        populate_dropdown();
        function populate_dropdown() {
            // get location
            getItems('../../ams_apis/slimTest/index.php/location', 'search_link_location', 'scroll_link_Location', 'menu_link_location', 'empty_link_location');
            // get room_no
            getItems('../../ams_apis/slimTest/index.php/room_no', 'search_link_room', 'scrol_link_room', 'menu_link_room', 'empty_link_room');

        }

        function getItems(url, id, scrollArea, menuid) {
            $.ajax({
                url: url,
                method: 'POST',
                dataType: 'JSON',
                data: '{"asset_class":"' + localStorage.filter + '","asset_location":"' + localStorage.menuLocation + '","asset_room":"' + localStorage.menuRoom + '","asset_id":"' + localStorage.menuAssets + '"}',
                success: function (data) {
                    console.log(data);
                    var rows = [];
                    var searchValue = document.getElementById(id);
                    // console.log("=============searchValue================");
                    // console.log(searchValue);
                    // console.log("=============searchValue=================");
                    for (var i = 0; i < data.rows; i++) {
                        rows.push({
                            values: [data.data[i]],
                            markup: '<input type="button" style="border-bottom:1px solid #ecebeb" class="dropdown-item form-control" type="button" value="' + data.data[i] + '"/>',
                            active: true
                        });
                    }

                    allArr[id] = rows;

                    filterItems(rows, id, scrollArea, menuid);


                },
                error: function (data_err) {
                    console.log("Error");
                    console.log(data_err);
                }
            })
        }

        var count = 0;

        var clusterize = {
            search_link_location: [],
            search_link_room: []
        };

        var filterRows = function (rows) {
            var results = [];
            for (var i = 0, ii = rows.length; i < ii; i++) {
                if (rows[i].active) results.push(rows[i].markup)
            }

            return results;
        }

        function filterItems(rows, value, scrollArea, menuid) {
            clusterize[value] = (new Clusterize({
                rows: filterRows(rows),
                scrollId: scrollArea,
                contentId: menuid
            }));

        }


        function checkFilter(key) {
            var res = {};

            switch (key) {
                case "searchasset":
                    res = { "btnId": "dropdown_assets", "btnContent": "ASSET NO..." };
                    break;
                case "searchroomno":
                    res = { "btnId": "dropdown_room", "btnContent": "ROOM NO..." };
                    break;
                case "searchlocation":
                    res = { "btnId": "dropdown_location", "btnContent": "LOCATION..." };
                    break;
                default:
                    res = { "btnId": "not found", "btnContent": "not found" };
                    break;
            }

            return res;
        }

        function createAssetDelimeter(assets_arr) {
            var send_assets = "";
            for (var i = 0; i < assets_arr.length; i++) {
                if (i == assets_arr.length - 1) {
                    send_assets += assets_arr[i];
                } else {
                    send_assets += assets_arr[i] + "^";
                }
            }

            return send_assets;
        }

        // $('#menuRoom').on('click', '.dropdown-item', function () {
        //     $('#dropdown_room').text($(this)[0].value);
        //     localStorage.menuRoom = $(this)[0].value;
        //     $('#clearAllFilters').prop('disabled', false);
        //     populate_dropdown();
        //     $("#dropdown_room").dropdown('toggle');
        //     $('#searchroomno').val($(this)[0].value);
        // });

        // $('#menuLocation').on('click', '.dropdown-item', function () {
        //     $('#dropdown_location').text($(this)[0].value);
        //     localStorage.menuLocation = $(this)[0].value;
        //     $('#clearAllFilters').prop('disabled', false);
        //     populate_dropdown();
        //     $("#dropdown_location").dropdown('toggle');
        //     $('#searchlocation').val($(this)[0].value);
        // });
        //Department Dropdown Check
        if (localStorage.filter == "ALL EQUIPMENT") {

            $('#class-options').append(new Option("ALL EQUIPMENT", "all_equip"));
            $('#class-options').append(new Option("FACILITIES MANAGEMENT", "fac_equip"));
            $('#class-options').append(new Option("IT EQUIPMENT", "it_equip"));
            $('#class-options').append(new Option("MEDICAL EQUIPMENT", "med_equip"));
            $('#class-options').prop('disabled', false);

            $('#class-options').on('change', function () {
                var filter = $("#class-options option:selected").text();
                localStorage.filter = filter;
                //clear btn text
                resetBtn('#dropdown_assets', 'ASSET NO...');
                resetBtn('#dropdown_room', 'ROOM...');
                resetBtn('#dropdown_location', 'LOCATION ...');

                //clear search inputs
                resetInput('#searchlocation', '');
                resetInput('#searchroomno', '');
                resetInput('#searchasset', '');

                localStorage.menuAssets = '';
                localStorage.menuLocation = '';
                localStorage.menuRoom = '';
                populate_dropdown();
            });

        }
        else {
            $('#class-options').append(new Option(localStorage.filter, "user_class"));
            $('#class-options').css({ "-moz-appearance": "none" });
            $('#class-options').prop('disabled', 'disabled');
        }

    </script>
</body>

</html>